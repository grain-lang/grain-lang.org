---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import BlogAuthor from "./BlogAuthor.astro";
import ChevronRightIcon from "./icons/ChevronRightIcon.astro";
import TwitterIcon from "./icons/TwitterIcon.astro";
import DiscordIcon from "./icons/DiscordIcon.astro";
import GrainLogo from "./icons/GrainLogo.astro";

interface Props {
  entry: CollectionEntry<"blog">;
}

const { entry } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>("/src/images/cover/*.jpg");
if (!images[entry.data.cover]) {
  throw new Error(`Image ${entry.data.cover} not found for blog`);
}
---

<div class="mx-auto max-w-[70rem] pb-5 lg:pb-28 px-5">
  <div class="my-6 md:my-10 flex justify-between items-center">
    <div>
      <GrainLogo class="w-8 h-8 md:w-12 md:h-12 inline-block align-middle fill-color-accent" />
      <span class="md:pl-1 text-2xl md:text-4xl font-semibold align-middle">The Grain Blog</span>
    </div>
    <div class="flex md:hidden gap-4 text-color-accent">
      <a
        href="https://twitter.com/grain_lang"
        target="_blank"
      >
        <TwitterIcon class="w-7 h-7 fill-color-accent" />
      </a>
      <a
        href="https://twitter.com/grain_lang"
        target="_blank"
      >
        <DiscordIcon class="w-7 h-7 fill-color-accent" />
      </a>
    </div>
    <div class="hidden md:block text-color-accent">
      Find us also on
      <a href="https://twitter.com/grain_lang" class="underline">Twitter</a>
      and
      <a href="https://discord.com/invite/grain-lang" class="underline">Discord</a>
    </div>
  </div>
  <div class="flex items-stretch bg-color-background-bright dark:bg-gray-variant-80 rounded-lg p-8 drop-shadow-xl">
    <div class="p-0 lg:p-6 lg:w-5/12">
      <h1 class="text-2xl font-bold mb-5"><a href={`/blog/${entry.slug}`}>{entry.data.title}</a></h1>
      <BlogAuthor entry={entry} imgClass="w-12 h-12" nameClass="text-lg" />
      <p class="my-4">{entry.data.subtitle}</p>
      <p class="[mask-image:linear-gradient(180deg,#000_60%,transparent)] my-4 text-color-dim h-24 overflow-hidden">{entry.body}...</p>
      <a href={`/blog/${entry.slug}`} class="font-medium text-purple-50 hover:text-purple-70">
        Read more
        <ChevronRightIcon class="inline-block w-4 mb-0.5" />
      </a>
    </div>
    <div class="w-0 lg:w-7/12 pl-6">
      <Image
        src={images[entry.data.cover]()}
        alt={entry.data.coverAttribution ?? `${entry.data.title} cover image`}
        class="w-full h-full object-cover rounded"
      />
    </div>
  </div>
</div>
